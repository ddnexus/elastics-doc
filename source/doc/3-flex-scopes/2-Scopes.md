---
layout: doc
badge: flex-scopes
title: flex-scopes - Scopes
---

# Scopes

The `Flex::Scopes` module is included in your `Flex::ActiveModel` models, so you can just use them without the `include Flex::ActiveModel` statement. On the other hand, you can include the `Flex::Scopes` with any class that includes any Flex module, and with a simple trick, also with your `ActiveRecord` models (that defines their own `scope` method) {% see 3.2#using_flexscopes_with_activerecord_models Using flex-scopes with ActiveRecord Models%} .


## Filter Scopes

The `flex-scope` gems implements only a few of the most commonly used elasticsearch filters, plus a generic `filters` scope that allows to add any other filter not explicitly defined as a scope. All the Filter Scopes return a `Flex::Scope` object.

{% slim filter_scopes_table.slim %}

## Variable Scopes

These scopes are a direct interface for the variables used to query. All the Variable Scopes return a `Flex::Scope` object.

{% slim variable_scopes_table.slim %}

## Query Scopes

All the Query Scopes methods actually perform the query generated by the scope and return some kind of result but not a scope object, so they are used as the last scope in the chain. They all accept a list of variables (which will be deep-merged with the variables contained in the scope itself).

If they are called on your class directly, they first generate an empty scope without restrictions, internally using the `scoped` method {% see 3.2#scoped scoped %}. Depending on the method, the result may be a single document, a collection of documents, or the actual instance(s) of your class when used with `Flex::ActiveModel` models. Others allow you to count or iterate over some retrieved collection.

{% slim query_scopes_table.slim %}

## Methods

{% slim scope_methods_table.slim %}

## Using flex-scopes with ActiveRecord Models

You must not include `Flex::Scopes` right in your `ActiveRecord` models: instead you should namespace your scopes and set the `context` to your model. For example:

{% highlight ruby %}
class MyModel < ActiveRecord::Base
  include Flex::ModelIndexer

  module Flex
    include Flex::Scopes
    flex.context = MyModel
    scope :red, terms(:color => 'red')
    ...
  end

end

total_red = MyModel::Flex.red.count
first_red = MyModel::Flex.red.first
{% endhighlight %}

> __Notice__: When you namespace the scopes, you must set the `flex.context` with your model class.
