table.code-topics.api-methods cellspacing=0 cellpadding=0



  ///////////////////////////////////////////////////////////////////////////
  tr
    th colspan=2
      a href="http://www.elasticsearch.org/guide/reference/api/index_/" target="_blank" Index

  tr
    td
      code Elastics.store
    td
      markdown:
        Stores a document into the index using `PUT`.

        **Template**

      |
        {% shighlight yaml %}
        store:
        - PUT
        - /<<index>>/<<type>>/<<id>>
        {% endshighlight %}

      markdown:
        **Usage**

      |
        {% shighlight ruby %}
        Elastics.store :id    => id,               # required
                      :type  => nil,
                      :index => "elastics_test_index"
        {% endshighlight %}

      markdown:
        > You must pass the source as the `:data` variable.

  tr
    td
      code Elastics.put_store
    td
      markdown:
        Alias of `Elastics.store` (defined for symmetry with `Elastics.post_store`)

  tr
    td
      code Elastics.post_store
    td
      markdown:
        Stores a document into the index using `POST`: the `:id` is assigned by elasticsearch.

        **Template**

      |
        {% shighlight yaml %}
        post_store:
        - POST
        - /<<index>>/<<type>>
        {% endshighlight %}

      markdown:
        **Usage**

      |
        {% shighlight ruby %}
        Elastics.post_store :index => "elastics_test_index",
                           :type  => nil
        {% endshighlight %}

      markdown:
        > You must pass the source as the `:data` variable.



  ///////////////////////////////////////////////////////////////////////////
  tr
    th colspan=2
      a href="http://www.elasticsearch.org/guide/reference/api/delete/" target="_blank" Delete

  tr
    td
      code Elastics.remove
    td
      markdown:
        Removes a document from the index.

        **Template**

      |
        {% shighlight yaml %}
        remove:
        - DELETE
        - /<<index>>/<<type>>/<<id>>
        {% endshighlight %}

      markdown:
        **Usage**

      |
        {% shighlight ruby %}
        Elastics.remove :id    => id,               # required
                       :type  => nil,
                       :index => "elastics_test_index"
        {% endshighlight %}



  ///////////////////////////////////////////////////////////////////////////
  tr
    th colspan=2
      a href="http://www.elasticsearch.org/guide/reference/api/get.html" target="_blank" Get

  tr
    td
      code Elastics.get
    td
      markdown:
        Retrieves a document from the index.

        **Template**

      |
        {% shighlight yaml %}
        get:
        - GET
        - /<<index>>/<<type>>/<<id>>
        {% endshighlight %}

      markdown:
        **Usage**

      |
        {% shighlight ruby %}
        Elastics.get :id    => id,               # required
                    :type  => nil,
                    :index => "elastics_test_index"
        {% endshighlight %}

  tr
    td
      code Elastics.get_source
    td
      markdown:
        Retrieves the source of a document from the index.

        **Template**

      |
        {% shighlight yaml %}
        get:
        - GET
        - /<<index>>/<<type>>/<<id>>/_source
        {% endshighlight %}

      markdown:
        **Usage**

      |
        {% shighlight ruby %}
        Elastics.get_source :id    => id,               # required
                           :type  => nil,
                           :index => "elastics_test_index"
        {% endshighlight %}



  ///////////////////////////////////////////////////////////////////////////
  tr
    th colspan=2
      a href="http://www.elasticsearch.org/guide/reference/api/multi-get.html" target="_blank" Multi Get

  tr
    td
      code Elastics.multi_get
    td
      markdown:
        Retrieves multiple documents

        **Template**

      |
        {% shighlight yaml %}
        multi_get:
        - GET
        - /<<index>>/<<type>>/_mget
        - ids: << ids >>
        {% endshighlight %}

      markdown:
        **Usage**

      |
        {% shighlight ruby %}
        Elastics.multi_get :ids   => ids,              # required
                          :type  => nil,
                          :index => "elastics_test_index"
        {% endshighlight %}



  ///////////////////////////////////////////////////////////////////////////
  tr
    th colspan=2
      a href="http://www.elasticsearch.org/guide/reference/api/update/" target="_blank" Update

  tr
    td
      code Elastics.update
    td
      markdown:
        Updates a document based on a script provided.

        **Template**

      | {% shighlight yaml %}
        update:
        - POST
        - /<<index>>/<<type>>/<<id>>/_update
        {% endshighlight %}

      markdown:
        **Usage**

        You must pass script or doc and the other options as the :data variable

      |
        {% shighlight ruby %}
        Elastics.update :id    => id,    # required
                       :type  => nil,
                       :index => "elastics_test_index"
        {% endshighlight %}



  ///////////////////////////////////////////////////////////////////////////
  tr
    th colspan=2
      a href="http://www.elasticsearch.org/guide/reference/api/search" target="_blank" Search

  tr
    td
      code YourClass.your_custom_search
    td
      markdown:
        The Search API is completely covered by the Elastics Templating system and mostly covered by the `elastics-scopes` gem.
      == Helper.see('2.3,3')



  ///////////////////////////////////////////////////////////////////////////
  tr
    th colspan=2
      a href="http://www.elasticsearch.org/guide/reference/api/multi-search.html" target="_blank" Multi Search


  tr
    td
      code YourClass.elastics.multi_search
    td
      markdown:

        > This method is documented here because it is an elasticsearch API method, however it is defined into your `elastics` proxy included by `Elastics::Templates`.

        The method allows you to do multi-searching by using multiple templates defined by your class. It takes 2 arguments. The first is a required hash with the templates names as the keys and the variable hash as the values. You can also use an array of arrays. The second is an optional hash of variables that will be used to render the `multi_search` template. The array of responses is available as `responses` method.

        **Template**

      |
        {% shighlight yaml %}
        multi_search:
        - GET
        - /<<index>>/<<type>>/_msearch
        {% endshighlight %}

      markdown:
        **Usage**

      |
        {% shighlight ruby %}
        result = MyClass.elastics.multi_search({:my_search_a => {:a_var => 'foo'},
                                                :my_search_b => {:another_var => 'bar'},
                                               {:index => 'another_index'})

        result.responses.each{|r| r.do_something }
        {% endshighlight %}



  ///////////////////////////////////////////////////////////////////////////
  tr
    th colspan=2
      a href="http://www.elasticsearch.org/guide/reference/api/percolate.html" target="_blank" Percolate

  tr
    td
      code Elastics.put_percolator
    td
      markdown:
        Registers a named percolator query against an index.

        **Template**

      |
        {% shighlight yaml %}
        put_percolator:
        - PUT
        - /_percolator/<<index>>/<<percolator>>
        {% endshighlight %}

      markdown:
        **Usage**

      |
        {% shighlight ruby %}
        Elastics.put_percolator :percolator => percolator,       # required
                                :index      => "elastics_test_index"
        {% endshighlight %}

  tr
    td
      code Elastics.delete_percolator
    td
      markdown:
        Unregisters a named percolator.

        **Template**

      |
        {% shighlight yaml %}
        delete_percolator:
        - DELETE
        - /_percolator/<<index>>/<<percolator>>
        {% endshighlight %}

      markdown:
        **Usage**

      |
        {% shighlight ruby %}
        Elastics.delete_percolator :percolator => percolator,       # required
                                   :index      => "elastics_test_index"
        {% endshighlight %}

  tr
    td
      code Elastics.percolate
    td
      markdown:
        Percolates a document.

        **Template**

      |
        {% shighlight yaml %}
        percolate:
        - GET
        - /<<index>>/<<type>>/_percolate
        {% endshighlight %}

      markdown:
        **Usage**

      |
        {% shighlight ruby %}
        Elastics.percolate :index => "elastics_test_index",
                           :type  => nil
        {% endshighlight %}

      markdown:
        > You must pass the document (and additional queries) as the `:data` variable)



  ///////////////////////////////////////////////////////////////////////////
  tr
    th colspan=2
      a href="http://www.elasticsearch.org/guide/reference/api/bulk.html" target="_blank" Bulk

  tr
    td
      code Elastics.post_bulk_string
    td
      markdown:
        Performs many index/create/update/delete operations in a single API call.

        **Template**

      |
        {% shighlight yaml %}
        post_bulk_string:
        - POST
        - /_bulk
        - << bulk_string >>
        {% endshighlight %}

      markdown:
        **Usage**

      |
        {% shighlight ruby %}
        Elastics.post_bulk_string :bulk_string => bulk_string   # required
        {% endshighlight %}

      markdown:
        It may return `nil` if you pass a blank `:bulk_string`

      br
      == Helper.see('1.4#elastics_import elastics:import,2.6#bulk_support')



  ///////////////////////////////////////////////////////////////////////////
  tr
    th colspan=2
      a href="http://www.elasticsearch.org/guide/reference/api/count.html" target="_blank" Count

  tr
    td
      code Elastics.count
    td
      markdown:
        Gets the number of matches for a query.

        **Template**

      |
        {% shighlight yaml %}
        count:
        - GET
        - /<<index>>/<<type>>/_count
        {% endshighlight %}

      markdown:
        **Usage**

      |
        {% shighlight ruby %}
        Elastics.count :index => "elastics_test_index",
                       :type  => nil
        {% endshighlight %}



  ///////////////////////////////////////////////////////////////////////////
  tr
    th colspan=2
      a href="http://www.elasticsearch.org/guide/reference/api/delete-by-query.html" target="_blank" Delete by Query

  tr
    td
      code Elastics.delete_by_query
    td
      markdown:
        Allows to delete documents from one or more indices and one or more types based on a query.

        **Template**

      |
        {% shighlight yaml %}
        delete_by_query:
        - DELETE
        - /<<index>>/<<type>>/_query
        {% endshighlight %}

      markdown:
        **Usage**

      |
        {% shighlight ruby %}
        Elastics.delete_by_query :index => "elastics_test_index",
                                 :type  => nil
        {% endshighlight %}

      markdown:
        > You can pass the query as the `:data` variable



  ///////////////////////////////////////////////////////////////////////////
  tr
    th colspan=2
      a href="http://www.elasticsearch.org/guide/reference/api/more-like-this.html" target="_blank" More Like This

  tr
    td
      code Elastics.more_like_this
    td
      markdown:
        Allows to get documents that are "like" a specified document.

        **Template**

      |
        {% shighlight yaml %}
        more_like_this:
        - GET
        - /<<index>>/<<type>>/<<id>>/_mlt
        {% endshighlight %}

      markdown:
        **Usage**

      |
        {% shighlight ruby %}
        Elastics.more_like_this :id    => id,          # required
                                :index => "elastics_test_index",
                                :type  => nil
        {% endshighlight %}

      markdown:
        > You can pass the search API (facets, from/to and so on) as the `:data` variable)

  tr
    td
      code  Elastics.mlt
    td
      markdown:
        Alias for `Elastics.more_like_this`



  ///////////////////////////////////////////////////////////////////////////
  tr
    th colspan=2
      a href="http://www.elasticsearch.org/guide/reference/api/validate/" target="_blank" Validate

  tr
    td
      code Elastics.validate
    td
      markdown:
        Allows to validate a potentially expensive query without executing it.

        **Template**

      |
        {% shighlight yaml %}
        validate:
        - GET
        - /<<index>>/<<type>>/_validate/query
        {% endshighlight %}

      markdown:
        **Usage**

      |
        {% shighlight ruby %}
        Elastics.validate :index => "elastics_test_index",
                          :type  => nil
        {% endshighlight %}

      markdown:
        > You must pass the query to validate as the `:data` variable
        > You can pass the parameters as the `:params` variable



  ///////////////////////////////////////////////////////////////////////////
  tr
    th colspan=2
      a href="http://www.elasticsearch.org/guide/reference/api/explain/" target="_blank" Explain

  tr
    td
      code Elastics.explain
    td
      markdown:
        Computes a score explanation for a query and a specific document.

        **Template**

      |
        {% shighlight yaml %}
        explain:
        - GET
        - /<<index>>/<<type>>/<<id>>/_explain
        {% endshighlight %}

      markdown:
        **Usage**

      |
        {% shighlight ruby %}
        Elastics.explain :id    => id,    # required
                         :type  => nil,
                         :index => "elastics_test_index"
        {% endshighlight %}

      markdown:
        > You must pass the query to explain as the `:data` variable
        > You can pass the parameters as the `:params` variable



  ///////////////////////////////////////////////////////////////////////////
  tr
    th colspan=2 id='elastics_additions'
      | Elastics Additions


  tr
    td
      code  Elastics.match_all
    td
      markdown:

        Not a real API method, but handy:

        **Template**

      |
        {% shighlight yaml %}
        match_all:
        - GET
        - /<<index>>/<<type>>/_search
        - query:
            match_all: {}
        {% endshighlight %}

      markdown:
        **Usage**

      |
        {% shighlight ruby %}
        Elastics.match_all :index => "elastics_test_index",
                           :type  => nil
        {% endshighlight %}


  tr
    td
      code  Elastics.search_by_id
    td
      markdown:
        Get a document without using the get API (which doesn't support fields '\*')

        **Template**

      |
        {% shighlight yaml %}
        search_by_id:
        - GET
        - /<<index>>/<<type>>/_search
        - query:
            term:
              _id: <<id>>
        {% endshighlight %}

      markdown:
        **Usage**

      |
        {% shighlight ruby %}
        Elastics.search_by_id :id      => id,    # required
                              :type    => nil,
                              :index   => "elastics_test_index"
        {% endshighlight %}

      markdown:
        > This method uses the search API, which is not real-time like the get API. You may want to refresh the index with `Elastics.refresh_index`, before calling it.

  tr
    td
      code  Elastics.scan_search
    td
      markdown:
        Generic implementation of the [elasticsearch search_type API](http://www.elasticsearch.org/guide/reference/api/search/search-type) of type `scan`. It passes the raw result to the block.

      markdown:
        **Usage**

      |
        {% shighlight ruby %}
        Elastics.scan_search(:my_template, my_vars) do |result|
          result['hits']['hits'].each{|d|do_something_with(d)}
        end
        {% endshighlight %}

  tr
    td
      code  Elastics.scan_all
    td
      markdown:
        Specific implementation of the [elasticsearch search_type API](http://www.elasticsearch.org/guide/reference/api/search/search-type) of type `scan`, applied to the `match_all` template/query. It passes an array of documents to the block.

      markdown:
        **Usage**

      |
        {% shighlight ruby %}
        Elastics.scan_all(my_vars) do |batch|
          batch.each{|d|do_something_with(d)}
        end
        {% endshighlight %}

  tr
    td
      code  Elastics.dump_all
    td
      markdown:
        It `flush_index` and call `scan_all`, with added `{:params => {:fields => '*,_source'}}`. Used to include all the relevant fields from a document:

      markdown:
        **Usage**

      |
        {% shighlight ruby %}
        Elastics.dump_all(my_vars) do |batch|
          batch.each{|d|do_something_with(d)}
        end
        {% endshighlight %}

  tr
    td
      code  Elastics.dump_one
    td
      markdown:
        It `flush_index` and call `search_by_id`, with added `{:params => {:fields => '*,_source'}}`. Used to include all the relevant fields from the document:

      markdown:
        **Usage**

      |
        {% shighlight ruby %}
        Elastics.dump_one :id      => id,    # required
                          :type    => nil,
                          :index   => "elastics_test_index"
        {% endshighlight %}
